---
title: å¦‚ä½•ç»™ shell è‡ªå®šä¹‰å¿«æ·é”®
pubDatetime: 2022-03-20
---

æœ€è¿‘åœ¨å¼€å‘çš„æ—¶å€™æœ‰åˆ»æ„çš„å»æ€è€ƒæœ‰å“ªäº›å½±å“è‡ªå·±å¼€å‘æ•ˆç‡çš„å› ç´ ã€‚æ¯”å¦‚æˆ‘å®é™…ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å½“ `zsh-autosuggestions` æ’ä»¶å®Œæ•´æç¤ºå‡ºä½ è¦è¿è¡Œçš„å‘½ä»¤ï¼Œä½†æ˜¯æˆ‘åœ¨ Mac ä¸Šè¦å…ˆè¾“å…¥ `cmd + ->`ï¼Œå†æ•²å›è½¦ã€‚è¾“å…¥ Mac è‡ªå¸¦é”®ç›˜çš„å³ç®­å¤´æ˜¯å¾ˆå½±å“è¾“å…¥æ•ˆç‡çš„ï¼Œå½“æ—¶æˆ‘å°±æƒ³ï¼Œæˆ‘èƒ½ä¸èƒ½é€šè¿‡å¿«æ·é”® `shift + enter` å®ç°æ¥å— zsh æç¤ºå¹¶å›è½¦è¿è¡Œã€‚åœ¨æ‘¸äº†ä¸¤å°æ—¶ ğŸŸ åï¼Œæ€»ç®—æ˜¯åœ¨ iterm2 å’Œ VSCode çš„ terminal éƒ½å®Œç¾å®ç°äº†è‡ªå·±çš„éœ€æ±‚ã€‚

![VSCode ç¤ºä¾‹](https://s2.loli.net/2022/03/20/LAEnPTpY4kiJvwN.gif)

### shell å¿«æ·é”®åŸç†

æœ¬è´¨ä¸Šå¯¹äº shell æ¥è¯´åªæœ‰è¾“å…¥è¾“å‡ºï¼Œå®ƒä¸ä¼šç›‘å¬ä½ ç³»ç»Ÿå¿«æ·é”®çš„ï¼Œç›‘å¬å¿«æ·é”®å…¶å®æ˜¯ç»ˆç«¯æ¨¡æ‹Ÿå™¨çš„è´£ä»»ï¼Œä»–ä¼šå°†ä½ è¾“å…¥çš„å¿«æ·é”®è½¬æ¢æˆå­—ç¬¦ä¸²åºåˆ—ã€‚å½“æˆ‘ä»¬ä½¿ç”¨äº†ç±»ä¼¼ `ctrl + ->` è¿™æ ·çš„å¿«æ·é”®ï¼Œshell ä¼šæ ¹æ®ä½ è¾“å…¥çš„å­—ç¬¦åºåˆ—æ¥è¯†åˆ«ä¸ºä¸€ä¸ªå¿«æ·æ“ã€‚

åœ¨ zsh ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å…ˆè¾“å…¥å¿«æ·é”® `ctrl + v` å†è¾“å…¥ä½ çš„å¿«æ·é”®ï¼Œæ¥çœ‹ä½ è¾“å…¥çš„å¿«æ·é”®è¢«è½¬æ¢æˆäº†ä»€ä¹ˆå­—ç¬¦åºåˆ—ï¼š

![å¿«æ·é”®å­—ç¬¦åºåˆ—](https://s2.loli.net/2022/03/20/rASvYOopwTcxIi6.gif)

å¯ä»¥çœ‹åˆ°å¿«æ·é”® `ctrl + ->` æœ¬è´¨ä¸Šæ˜¯ç»™ shell è¾“äº†å­—ç¬¦åºåˆ—: `^[[1;5C`ã€‚

## è‡ªå®šä¹‰ shell å¿«æ·é”®

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†æœ¬è´¨ä¸Šæˆ‘ä»¬è¾“å…¥çš„å¿«æ·é”®ä¼šè¢«ç»ˆç«¯æ¨¡æ‹Ÿå™¨è½¬æ¢æˆä¸€ç³»åˆ—çš„å­—ç¬¦åºåˆ—ä¼ ç»™ shellã€‚å¸¸è§çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¾‹å¦‚ iterm2 å’Œ VSCode çš„ xterm éƒ½æ”¯æŒå°†ä½ çš„å¿«æ·é”®è½¬æ¢è¾“å…¥ä¸€æ®µæŒ‡å®šçš„å­—ç¬¦åºåˆ—ã€‚

è€Œåœ¨ zsh ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ `bindkey` å‘½ä»¤æ¥å®šä¹‰å¿«æ·é”®ï¼Œä¹Ÿå°±æ˜¯åœ¨ zsh æ¥æ”¶åˆ°æŸä¸ªå­—ç¬¦åºåˆ—æ—¶æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚

é€šè¿‡å‘½ä»¤ `bindkey -l` å¯ä»¥æŸ¥çœ‹ zsh ä¸­å®šä¹‰çš„ä¸€äº›å¿«æ·é”®é›†åˆï¼š

```bash
â¯ bindkey -l
.safe
command
emacs
isearch
listscroll
main
menuselect
vicmd
viins
viopp
visual
```

ä½¿ç”¨å‘½ä»¤ `bindkey -M é›†åˆå` å¯ä»¥æŸ¥çœ‹è¯¥é›†åˆä¸­çš„æ‰€æœ‰å¿«æ·é”®ï¼š

```bash
â¯ bindkey -M main
"^@" set-mark-command
"^A" beginning-of-line
"^B" backward-char
"^D" delete-char-or-list
"^E" end-of-line
"^F" forward-char
# more...
```

æŸ¥é˜… [zsh-autosuggestions](https://github.com/zsh-users/zsh-autosuggestions#key-bindings) çš„æ–‡æ¡£æˆ‘ä»¬å¾—çŸ¥ï¼Œå¦‚æœè¦ç›´æ¥æ‰§è¡Œ zsh çš„æç¤ºå¯ä»¥ç”¨ä¸‹é¢çš„å½¢å¼å®šä¹‰å¿«æ·é”®ï¼š

```bash
# ä½¿ç”¨ ctrl + space å¿«æ·é”®ç›´æ¥æ‰§è¡Œå½“å‰ zsh æç¤º
bindkey '^ ' autosuggest-accept
```

`ctrl + space` æˆ‘è§‰å¾—ä¸å¤ªç¬¦åˆè¿™ä¸ªæ“ä½œçš„å«ä¹‰ï¼Œæˆ‘æƒ³æ”¹æˆ `shift + enter`ï¼Œå¯¹åº”çš„è‡ªå®šä¹‰å¿«æ·é”®ä»£ç å¯ä»¥æ”¹æˆï¼š

```bash
bindkey '^[SE' autosuggest-execute
```

ä¹Ÿå°±æ˜¯è¯´åœ¨ zsh åœ¨æ”¶åˆ°å­—ç¬¦åºåˆ— `^[SE` çš„æ—¶å€™ä½ å»ç›´æ¥æ‰§è¡Œ zsh çš„æç¤ºã€‚è¿™ä¸ªå­—ç¬¦åºåˆ—å…¶å®åªè¦ä½ æ˜¯ä»¥æ§åˆ¶å­—ç¬¦å¼€å¤´å°±è¡Œï¼Œä¸€èˆ¬æ¥å°†ç”¨ `^[` å¼€å¤´å°±è¡Œäº†ï¼Œåé¢çš„ `SE` æ˜¯å¯ä»¥éšä¾¿å†™çš„ï¼Œä¸å’Œå…¶å®ƒå¿«æ·é”®å†²çªå°±è¡Œï¼Œè¿™é‡Œæˆ‘ç”¨ SE åªå°±æ˜¯æƒ³è¡¨è¾¾ `shift` å’Œ `enter` é”®ã€‚

é‚£ä¹ˆç°åœ¨é—®é¢˜æ¥åˆ°å¦‚ä½•åœ¨ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¸­é…ç½®å¿«æ·é”®å¯¹åº”çš„å­—ç¬¦åºåˆ—ã€‚

### iterm2 é…ç½®å¿«æ·é”®å­—ç¬¦åºåˆ—

æ‰“å¼€ iterm2ï¼Œé€šè¿‡æ“ä½œè·¯å¾„ `Preference -> Profiles -> Keys -> Key Mappings` æ‰“å¼€é”®ä½æ˜ å°„é…ç½®ã€‚æˆ‘ä»¬å…ˆåˆ‡æ¢é¢„è®¾ä¸º `Natural Text Editing`ï¼Œæ³¨æ„åˆ‡æ¢çš„æ—¶å€™ä¼šæç¤ºæ˜¯å¦ä¿ç•™ä¹‹å‰çš„å¿«æ·é”®ï¼Œå»ºè®®æ˜¯ä¿ç•™ã€‚

![Key Mappings](https://s2.loli.net/2022/03/20/fL9uTiM2V6K3om5.png)

ç‚¹å‡»é¢„è®¾ Presets æ—è¾¹çš„ `+` å·æ·»åŠ å¿«æ·é”®ï¼ŒAction æˆ‘ä»¬é€‰æ‹©è¾“å…¥æ–‡æœ¬ï¼Œæ–‡æœ¬å†…å®¹ä¸ºå¿«æ·é”®è¦ä¼ ç»™ shell çš„å­—ç¬¦åºåˆ— `^[SE`ï¼š

![iterm2 è®¾ç½®å¿«æ·é”®](https://s2.loli.net/2022/03/20/aBPskf25TVMrLwx.png)

OKï¼Œè¿™æ ·æˆ‘ä»¬å°±é…ç½®å¥½äº† iterm2 ä½¿ç”¨å¿«æ·é”® `shift + enter` ç›´æ¥æ‰§è¡Œ zsh æç¤ºçš„è¯­å¥äº†ã€‚

### VSCode é›†æˆç»ˆç«¯è‡ªå®šä¹‰å¿«æ·é”®å­—ç¬¦åºåˆ—

æŸ¥çœ‹ VSCode é›†æˆç»ˆç«¯çš„å®˜æ–¹æ–‡æ¡£: [Integrated Terminal in Visual Studio Code](https://code.visualstudio.com/docs/editor/integrated-terminal#_send-text-via-a-keybinding)ã€‚æˆ‘ä»¬å¾—çŸ¥å¦‚æœé…ç½®é›†æˆç»ˆç«¯å°†å¿«æ·é”®è½¬æ¢è‡ªå®šä¹‰çš„å­—ç¬¦åºåˆ—éœ€è¦åƒä¸‹é¢è¿™æ ·é…ç½®å¿«æ·é”®ã€‚é€šè¿‡ `cmd + shift + p` æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ `open shortcuts json` æ‰“å¼€ VSCode çš„å¿«æ·é”®é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å¿«æ·é”®é…ç½®ï¼š

```json
// keybinding.json
{
  "key": "shift+enter",
  "command": "workbench.action.terminal.sendSequence",
  "when": "terminalFocus",
  // text å‚æ•°å°±æ˜¯ä½ éœ€è¦è¾“å…¥ç»™ shell çš„è‡ªå®šä¹‰åºåˆ—
  "args": { "text": "\u001bSE" }
}
```

`\u001b` å¯¹åº”çš„å°±æ˜¯è¾“å…¥ `^[`ï¼Œè¿™ä¸ªå¯ä»¥æŸ¥çœ‹ xterm çš„æºç å¯çŸ¥ï¼š[List of C0 and C1 control codes](https://github.com/xtermjs/xterm.js/blob/0e45909c7e79c83452493d2cd46d99c0a0bb585f/src/common/data/EscapeSequences.ts)ã€‚

æœ¬æ–‡è®²çš„å†…å®¹åªåœ¨ zsh ä¸Šè¿›è¡Œè¿‡æµ‹è¯•ï¼Œæƒ³å¿…å…¶å®ƒå¹³å°çš„ shell åº”è¯¥æ˜¯å¤§åŒå°å¼‚ï¼Œå¯èƒ½ä¼šäº›ä¸ä¸€æ ·ï¼Œè¯»è€…éœ€è¦è‡ªè¡Œæ‘¸ç´¢ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥åœ¨è¯„è®ºåŒºæå‡ºæ¥ã€‚

æœ¬æ–‡å®Œã€‚

æœªç»æœ¬äººå…è®¸ï¼Œç¦æ­¢è½¬è½½ï¼Œç›®å‰åªå‘è¡¨äºçŸ¥ä¹å’Œæ˜é‡‘å¹³å°ã€‚
